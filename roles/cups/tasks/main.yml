---
- name: install packages
  apt:
    name: "{{ item }}"
  with_items:
    - cups
    - printer-driver-cups-pdf
    - printer-driver-fujixerox

# Enable on-demand service
- name: disable cups.service
  service:
    name: cups.service
    enabled: no
    state: stopped

- name: enable cups.socket
  service:
    name: cups.socket
    enabled: yes
    state: started

# Make IdleExitTimeout works
- name: disable web interface
  command: cupsctl WebInterface=no

- name: create lpadmin user
  user:
    name: lpadmin
    group: lpadmin
    home: /var/spool/lpd
    shell: /usr/sbin/nologin
    password: "{{ cups_admin_password }}"
    createhome: no
