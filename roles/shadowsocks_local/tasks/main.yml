---
- name: install polipo
  apt: name=polipo

- name: config polipo
  lineinfile:
    dest: /etc/polipo/config
    regexp: "{{ item.regexp }}"
    line: "{{ item.line }}"
  with_items:
    - regexp: ^socksParentProxy =
      line: socksParentProxy = "127.0.0.1:{{ shadowsocks.local_port }}"
    - regexp: ^socksProxyType =
      line: socksProxyType = socks5
    - regexp: ^diskCacheRoot =
      line: diskCacheRoot = ""
  notify: restart polipo
